-- 23. Find top 3 products by revenue in each product category.

select * from (SELECT t2.product_id, t2.product_category_name, price, 
  rank() over(partition by product_category_name order by price desc) as rn
  FROM project.olist_order_items_dataset t1
  JOIN project.olist_products_dataset t2 
  on t1.product_id = t2.product_id 
  order by product_category_name, t2.product_id) as n where rn < 4;
